<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="EverLose, EverLose">


        <title>Python2与Python3的对比 // EverLose // EverLose</title>

    <link href="./theme/images/icons/favicon.ico" rel="icon">

    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <link rel="stylesheet" href="./theme/css/font-awesome.min.css">
    <link rel="stylesheet" href="./theme/css/pure.css">
    <!-- Custom style -->
    <link rel="stylesheet" type="text/css" href="./theme/css/style.css">
    <link rel="stylesheet" href="./theme/css/pygments.css">

    <script src="./theme/js/jquery-2.1.1.min.js"></script>
    <script src="./theme/js/jquery.fitvids.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img" style="background-image: url('http://everlose.qiniudn.com/sanqiao.jpg')">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href=".">EverLose</a></h1>
                            <p class="tagline">EverLose</p>
                                <p class="social">
                                    <a href="http://weibo.com/mutoulbj">
                                        <i class="fa fa-weibo fa-3x"></i>
                                    </a>
                                    <a href="http://github.com/mutoulbj">
                                        <i class="fa fa-github fa-3x"></i>
                                    </a>
                                    <a href="http://twitter.com/mutoulbj">
                                        <i class="fa fa-twitter fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Python2与Python3的对比</h1>
                        <p class="post-meta">
                            <i class="fa fa-book"></i>                                 <a class="post-category" href="./tag/python.html">python</a>
                        </p>
                </header>
            </section>
            <p>这篇文章总结了一些与Python2.6相比Python3.0中的新特性.Python3是一个不向后兼容的版本，有了很多的改变，这些对于Python开发者来说是非常重要的，虽然多数人说Python3真正流行起来还需要一段时间，但是Python3确实有了很大的改进，现在也是时间来学习Python3了。在真正理解Python3中的一些变化之后，会发现其实Python3的变化并没有想象的那么多，主要是修复了一些令人讨厌的地方。  </p>
<p>一般在每一个发行版源码的<code>Misc/NEWS</code>文件中详细描述了每一个细小的变化。  </p>
<h2>常见的障碍</h2>
<h4>Print是一个函数</h4>
<p>在Python3中<code>print</code>是个函数，这意味着在使用的时候必须带上小括号,并且它是带有参数的。  </p>
<div class="highlight"><pre><span></span><span class="n">old</span><span class="p">:</span> <span class="k">print</span> <span class="s2">&quot;The answer is&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="mi">2</span>
<span class="n">new</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The answer is&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>  

<span class="n">old</span><span class="p">:</span> <span class="k">print</span> <span class="n">x</span><span class="p">,</span>      <span class="c1"># 末尾加上逗号阻止换行  </span>
<span class="n">new</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># 使用空格来代替新的一行  </span>

<span class="n">old</span><span class="p">:</span> <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">staerr</span><span class="p">,</span> <span class="s2">&quot;fatal error&quot;</span>  
<span class="n">new</span><span class="p">:</span> <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;fatal error&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>  

<span class="n">old</span><span class="p">:</span> <span class="k">print</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>   <span class="c1"># 打印出元组(x, y) </span>
<span class="n">new</span><span class="p">:</span> <span class="k">print</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>  <span class="c1"># 同上,在python3中print(x, y)的结果是跟这不同的  </span>
</pre></div>


<p>在Python3中还可以定义分隔符，使用参数sep来指定.  </p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;There are &lt;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;&gt;possibilities&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>   
</pre></div>


<p>上面代码的结果如下:  </p>
<div class="highlight"><pre><span></span>There are &lt;7&gt; possibilities  
</pre></div>


<blockquote>
<p>注意:  </p>
<ul>
<li>
<p><code>print()</code>函数不支持Python2.X中<code>print</code>中的“软空格”。在Python2.X中,<code>print "A\n", "B"</code>的结果是"A\nB\n";而在Python3中<code>print("A\n", "B")</code>的结果是<code>"A\n B\n"</code>。   </p>
</li>
<li>
<p>在刚开始使用Python3的时候,你会发现你经常在交互模式下你还是经常使用老式的语法<code>print x</code>,是时候锻炼你的手指用<code>print(x)</code>来取代它啦。   </p>
</li>
<li>
<p>如果你的项目比较大,而又想升级到Python3的时候,不用担心,<code>2to3</code>这个工具会将所有的<code>print</code>语句转换为<code>print()</code>函数。  </p>
</li>
</ul>
</blockquote>
<h4>使用Views和Iterators代替Lists</h4>
<ul>
<li><code>dict</code>的方法<code>dict.keys()</code>,<code>dict.items()</code>,<code>dict.values()</code>不会再返回列表,而是返回一个易读的“views”。这样一来，像这样的语法将不再有用了:<code>k = d.keys();k.sort()</code>,你可以使用<code>k = sorted(d)</code>来代替。<code>sorted(d)</code>在Python2.5及以后的版本中也有用，但是Python3效率更高了。</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>     <span class="c1"># dict_keys([&#39;a&#39;])  </span>
<span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>    <span class="c1"># dict_items([(&#39;a&#39;, 1)])  </span>
<span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>   <span class="c1"># dict_values([1])  </span>
<span class="n">k</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">();</span> <span class="n">k</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>     <span class="c1"># AttributeError: &#39;dict_keys&#39; object has no attribute &#39;sort&#39;  </span>
</pre></div>


<ul>
<li>
<p>同样，<code>dict.iterkeys()</code>,<code>dict.iteritems()</code>,<code>dict.itervalues()</code>方法也不再支持。  </p>
</li>
<li>
<p><code>map()</code>和<code>filter()</code>将返回<em>iterators</em>。如果你真的想要得到列表,<code>list(map(...))</code>是一个快速的方法，但是更好的方法是使用列表推导(尤其是原代码使用了lambda表达式的时候),或者重写原来的代码,改为不需要使用列表。特别是<code>map()</code>会给函数带来副作用，正确的方法是改为使用<code>for</code>循环，因为创建一个列表是非常浪费的事情。  </p>
</li>
<li>
<p>Python3中的<code>range()</code>函数跟Python2.X的<code>xrange()</code>函数的作用是一样的，这样可以使用任意的数字,Python3中去除了<code>xrange()</code>函数。  </p>
</li>
<li>
<p><code>zip()</code>在Python3中返回的是一个迭代器。  </p>
</li>
</ul>
<h4>比较符</h4>
<p>Python3简化了比较符。  </p>
<ul>
<li>
<p>在使用比较符(&lt;,&lt;=,&gt;=,&gt;)时，当相比较的操作数的排序是没有意义的时候将会抛出<code>TypeError</code>异常,因此像<code>1 &lt; ''</code>,<code>0 &gt; None</code>,<code>len &lt;= len</code>这样的语句不再合法了。<code>None &lt; None</code>也会抛出<code>TypeError</code>异常，而不是返回<code>False</code>。你应该明白了,胡乱的比较是没有意义的,相比较的元素必须是能够比较的才行。需要注意的是,<code>==</code>和<code>!=</code>不包括在内,因为不通类型的,无法比较元素总是不等于另一个的。  </p>
</li>
<li>
<p><code>builtin.sorted</code>和<code>list.sort()</code>不再有提供比较函数的cmp参数,只有参数<code>key</code>和<code>reverse</code>。  </p>
</li>
<li>
<p><code>cmp()</code>函数应该当做被去除了,<code>__cmp__()</code>特殊方法也不再支持。在需要的时候使用<code>__lt__</code>,<code>__eg__</code>和<code>__hash__</code>。  </p>
</li>
</ul>
<h4>整型数</h4>
<ul>
<li>
<p>从本质上来说,<code>long</code>重命名了<code>int</code>,因为在内置只有一个名为<code>int</code>的整型,但它基本跟之前的<code>long</code>一样。  </p>
</li>
<li>
<p>像<code>1/2</code>这样的语句将返回<code>float</code>，即0.5。使用<code>1//2</code>来获取整型,这也是之前版本所谓的“地板除”。  </p>
</li>
<li>
<p>移除了<code>sys.maxint</code>,因为整型数已经没了限制。<code>sys.maxsize</code>可以用来当做一个比任何列表和字符串下标都要大的整型数。  </p>
</li>
<li>
<p><code>repr()</code>中比较大的整型数将不再带有<code>L</code>后缀。  </p>
</li>
<li>
<p>八进制数的字面量使用<code>0o720</code>代替了<code>0720</code>。  </p>
</li>
</ul>
<h4>Text Vs. Data 代替 Unicode Vs. 8-bit</h4>
<p>Python3中改变了二进制数据和Unicode字符串。  </p>
<ul>
<li>
<p>Python3使用文本和(二进制)数据的理念代替之前的Unicode字符串和8-bit字符串,所有的文本默认是Unicode编码。使用<code>str</code>类型保存文本,使用<code>bytes</code>类型保存数据。当你混淆文本和数据的时候Python3会抛出<code>TypeError</code>的错误。  </p>
</li>
<li>
<p>不能再使用<code>u"..."</code>字面量表示unicode文本,而必须使用<code>b"..."</code>字面量表示二进制数据。  </p>
</li>
<li>
<p>因为<code>str</code>和<code>bytes</code>不能弄混,所以你必须显式地将他们进行转换。使用<code>str.encode()</code>将<code>str</code>转换为<code>bytes</code>，使用<code>bytes.decode()</code>将<code>bytes</code>转换为<code>str</code>,也可以使用<code>bytes(s, encoding=...)</code>和<code>str(b, encoding=...)</code>。  </p>
</li>
<li>
<p><code>str</code>和<code>bytes</code>都是不可变的类型，有一个分离的可变类型的<code>bytearray</code>可以保存缓存的二进制数据,所有能够接受<code>bytes</code>的API都能够使用<code>bytearray</code>。这些可变的API是基于<code>collections.MutableSequence</code>的。  </p>
</li>
<li>
<p>移除了抽象类型<code>basestring</code>，使用<code>str</code>代替。  </p>
</li>
<li>
<p>文件默认使用文本类型打开,这也是<code>open()</code>函数默认的。如果要打开二进制文件必须使用<code>b</code>参数,否则会出现错误,而不会默默地提供错误的数据。  </p>
</li>
<li>
<p>文件名都使用unicode字符串传入和输出。  </p>
</li>
<li>
<p>一些关于系统的API，如<code>os.environ</code>和<code>sys.argv</code>,当系统允许<code>bytes</code>并且不能正常转换为unicode的话,也会出现问题。所以，将系统的<code>LANG</code>设置好是最好的做法。  </p>
</li>
<li>
<p><code>repr()</code>函数不再转义非ASCII字符。  </p>
</li>
<li>
<p>代码默认为UTF-8编码。  </p>
</li>
<li>
<p>移除了<code>StringIO</code>和<code>cStringIO</code>。加入了<code>io</code>模块,并分别使用<code>io.StringIO</code>和<code>io.BytesIO</code>分别用于text和data。  </p>
</li>
</ul>
<h2>语法改变</h2>
<h4>新增语法</h4>
<ul>
<li>
<p>函数变量和返回值<a href="http://www.python.org/dev/peps/pep-3107/">annotations</a>。 </p>
</li>
<li>
<p><a href="http://www.python.org/dev/peps/pep-3102/">Keyword-only</a>变量。  </p>
</li>
<li>
<p><code>nonlocal</code>声明。使用<code>nonlocal x</code>可以直接引用一个外部作用域的变量,但不是全局变量。  </p>
</li>
<li>
<p>扩展了迭代的解包。  </p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  
<span class="n">a</span>   <span class="c1"># 0</span>
<span class="n">rest</span> <span class="c1"># [1,2,3]</span>
<span class="n">b</span>   <span class="c1"># 4  </span>
</pre></div>


<ul>
<li>字典推导。<code>{k: v for k, v in stuff }</code>。  </li>
</ul>
<div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>  
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t</span><span class="p">}</span>  
<span class="n">d</span>     <span class="c1"># {1: 1, 2: 2}  </span>
</pre></div>


<ul>
<li>
<p>集合推导。<code>{x for x in stuff}</code>，与<code>set(stuff)</code>效果一样,但是更加灵活。  </p>
</li>
<li>
<p>八进制字面量<code>0o720</code>。  </p>
</li>
<li>
<p>二进制字面量<code>0b1010</code>,相当于新的内置函数<code>bin()</code>。  </p>
</li>
<li>
<p>字节字面量<code>b</code>或者<code>B</code>,相当于新的内置函数<code>bytes()</code>。  </p>
</li>
</ul>
<h4>改变的语法</h4>
<ul>
<li>
<p>将<code>except exc, var</code>改为<code>except exc as var</code>。  </p>
</li>
<li>
<p>新的元类语法。   </p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># old  </span>
<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">M</span>
    <span class="o">....</span>  

<span class="c1"># new  </span>
<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>  
    <span class="o">....</span>  
</pre></div>


<ul>
<li>
<p>列表推导不再支持<code>[... for var in item1, item2, ...]</code>，必须写成<code>[... for var in (item1, item2,...)]</code>。  </p>
</li>
<li>
<p>省略号<code>...</code>作为连续表达式可以用于任何地方,之前只能用于分片中。但是必须连续写,之前带空格的<code>. . .</code>不再支持。  </p>
</li>
</ul>
<h3>移除的语法</h3>
<ul>
<li>
<p>移除了元组的解包。不能再写<code>def foo(a, (b, c)): ....</code>,需要写成<code>def foo(a, b_c):b, c = b_c</code>。  </p>
</li>
<li>
<p>移除<code>&lt;&gt;</code>,使用<code>!=</code>代替。  </p>
</li>
<li>
<p><code>exec()</code>不能再作为关键词,只能作为一个函数。并且<code>exec()</code>不再支持流变量,如<code>exec(f)</code>需写成<code>exec(f.read())</code>。  </p>
</li>
<li>
<p>整型不支持<code>l/L</code>后缀。  </p>
</li>
<li>
<p>字符串不支持<code>'u/U'</code>前缀。  </p>
</li>
<li>
<p><code>from module import *</code>只能用在模块级,在函数中不可使用。  </p>
</li>
<li>
<p>所有不以<code>.</code>开始的import语句均作为绝对路径的import对待。  </p>
</li>
<li>
<p>移除了经典类。  </p>
</li>
</ul>
            <a href="#" class="go-top">Go Top</a>
    <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "everlose"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
<footer class="footer">
    <p>&copy; 木头lbj &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>